const t=function(){function t(){}return t.prototype.then=function(n,i){const r=new t,o=this.s;if(o){const t=1&o?n:i;if(t){try{e(r,1,t(this.v))}catch(t){e(r,2,t)}return r}return this}return this.o=function(t){try{const o=t.v;1&t.s?e(r,1,n?n(o):o):i?e(r,1,i(o)):e(r,2,o)}catch(t){e(r,2,t)}},r},t}();function e(n,i,r){if(!n.s){if(r instanceof t){if(!r.s)return void(r.o=e.bind(null,n,i));1&i&&(i=r.s),r=r.v}if(r&&r.then)return void r.then(e.bind(null,n,i),e.bind(null,n,2));n.s=i,n.v=r;const o=n.o;o&&o(n)}}function n(e){return e instanceof t&&1&e.s}const i="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator",r="undefined"!=typeof Symbol?Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")):"@@asyncIterator";function o(o,s,a){if("function"==typeof o[r]){var u=new t,h=o[r]();return h.next().then(f).then(void 0,l),u;function c(t){if(a&&a())return e(u,1,h.return?h.return().then(function(){return t}):t);h.next().then(f).then(void 0,l)}function f(t){t.done?e(u,1):Promise.resolve(s(t.value)).then(c).then(void 0,l)}function l(t){e(u,2,h.return?h.return().then(function(){return t}):t)}}return Promise.resolve(function(r,o,s){if("function"==typeof r[i]){var a,u,h,c=r[i]();if(function i(r){try{for(;!((a=c.next()).done||s&&s());)if((r=o(a.value))&&r.then){if(!n(r))return void r.then(i,h||(h=e.bind(null,u=new t,2)));r=r.v}u?e(u,1,r):u=r}catch(n){e(u||(u=new t),2,n)}}(),c.return){var f=function(t){try{a.done||c.return()}catch(t){}return t};if(u&&u.then)return u.then(f,function(t){throw f(t)});f()}return u}if(!("length"in r))throw new TypeError("Object is not iterable");for(var l=[],p=0;p<r.length;p++)l.push(r[p]);return function(i,r,o){var s,a,u=-1;return function h(c){try{for(;++u<i.length&&(!o||!o());)if((c=r(u))&&c.then){if(!n(c))return void c.then(h,a||(a=e.bind(null,s=new t,2)));c=c.v}s?e(s,1,c):s=c}catch(n){e(s||(s=new t),2,n)}}(),s}(l,function(t){return o(l[t])},s)}(o,function(t){return Promise.resolve(t).then(s)},a))}const s={},a=function(){function n(t){this._entry=t,this._pact=null,this._resolve=null,this._return=null,this._promise=null}function i(t){return{value:t,done:!0}}function o(t){return{value:t,done:!1}}return n.prototype._yield=function(e){return this._resolve(e&&e.then?e.then(o):o(e)),this._pact=new t},n.prototype.next=function(n){const r=this;return r._promise=new Promise(function(o){const a=r._pact;if(null===a){const e=r._entry;if(null===e)return o(r._promise);function u(t){r._resolve(t&&t.then?t.then(i):i(t)),r._pact=null,r._resolve=null}r._entry=null,r._resolve=o;var h=e(r);h&&h.then?h.then(u,function(e){if(e===s)u(r._return);else{const n=new t;r._resolve(n),r._pact=null,r._resolve=null,_resolve(n,2,e)}}):u(h)}else r._pact=null,r._resolve=o,e(a,1,n)})},n.prototype.return=function(t){const n=this;return n._promise=new Promise(function(r){const o=n._pact;if(null===o)return null===n._entry?r(n._promise):(n._entry=null,r(t&&t.then?t.then(i):i(t)));n._return=t,n._resolve=r,n._pact=null,e(o,2,s)})},n.prototype.throw=function(t){const n=this;return n._promise=new Promise(function(i,r){const o=n._pact;if(null===o)return null===n._entry?i(n._promise):(n._entry=null,r(t));n._resolve=i,n._pact=null,e(o,2,t)})},n.prototype[r]=function(){return this},n}();var u=function(){this._events={}};u.prototype.emit=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=this._events[t]||[];i<r.length;i+=1)r[i].apply(void 0,e)},u.prototype.on=function(t,e){var n=this;return(this._events[t]=this._events[t]||[]).push(e),function(){return n._events[t]=n._events[t].filter(function(t){return t!==e})}},u.prototype.allOff=function(){this._events={}};var h=function(t){this._data=t},c={data:{configurable:!0}};c.data.get=function(){return this._data},h.prototype.drawing=function(t,e){try{var n=this,i=n._data.drawOption,r=i.color,s=i.thickness,a=i.lineCap,u=t.canvas,h=u.width,c=u.height;r&&(t.strokeStyle=r),s&&(t.lineWidth=s),a&&(t.lineCap=a),t.beginPath();var f=o(e,function(e){var i=e.relativePosition,r=i.x,o=i.y;n._data.positions.length?(t.lineTo(h*r,c*o),t.stroke()):t.moveTo(h*r,c*o),n._data.positions.push({x:r,y:o})});return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},h.prototype.render=function(t){if(this._data.positions.length){var e=this._data.drawOption,n=e.color,i=e.thickness,r=e.lineCap,o=t.canvas,s=o.width,a=o.height;n&&(t.strokeStyle=n),i&&(t.lineWidth=i),r&&(t.lineCap=r),t.beginPath();for(var u=0,h=this._data.positions;u<h.length;u+=1){var c=h[u];t.lineTo(s*c.x,a*c.y),t.stroke()}}},Object.defineProperties(h.prototype,c);var f=function(t){this._data=t},l={data:{configurable:!0}};l.data.get=function(){return this._data},f.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,s=i.height,a=o(e,function(e){n._data.positions.push(e.relativePosition),t.clearRect(0,0,r,s),n.render(t)});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},f.prototype.render=function(t){var e=this._data,n=e.drawOption,i=n.color,r=n.thickness,o=n.lineCap,s=e.positions;if(!(s.length<2)){var a=t.canvas,u=a.width,h=a.height,c=s[0],f=c.x,l=c.y,p=s[s.length-1],d=p.x,v=p.y;i&&(t.strokeStyle=i),r&&(t.lineWidth=r),o&&(t.lineCap=o),t.beginPath(),t.moveTo(f*u,l*h),t.lineTo(d*u,v*h),t.stroke()}},Object.defineProperties(f.prototype,l);var p=function(t){this._data=t},d={data:{configurable:!0}};d.data.get=function(){return this._data},p.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,s=i.height,a=o(e,function(e){n._data.positions.push(e.relativePosition),t.clearRect(0,0,r,s),n.render(t)});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},p.prototype.render=function(t){var e=this._data,n=e.drawOption,i=n.color,r=n.thickness,o=n.lineCap,s=e.positions;if(!(s.length<2)){var a=t.canvas,u=a.width,h=a.height,c=s[0],f=c.x,l=c.y,p=s[s.length-1],d=p.x,v=p.y;i&&(t.strokeStyle=i),r&&(t.lineWidth=r),o&&(t.lineCap=o),t.strokeRect(f*u,l*h,(d-f)*u,(v-l)*h)}},Object.defineProperties(p.prototype,d);var v=function(t){this._data=t},_={data:{configurable:!0}};_.data.get=function(){return this._data},v.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,s=i.height,a=o(e,function(e){n._data.positions.push(e.relativePosition),t.clearRect(0,0,r,s),n.render(t)});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},v.prototype.render=function(t){var e=this._data,n=e.drawOption,i=n.color,r=n.thickness,o=n.lineCap,s=e.positions;if(!(s.length<2)){var a=t.canvas,u=s[0],h=s[s.length-1];i&&(t.strokeStyle=i),r&&(t.lineWidth=r),o&&(t.lineCap=o),t.beginPath();var c=u.x*a.width,f=u.y*a.height,l=h.x*a.width-c,p=h.y*a.height-f,d=4*(Math.sqrt(2)-1)/3,v=l/2*d,_=p/2*d,g=c+l,y=f+p,w=c+l/2,m=f+p/2;t.beginPath(),t.moveTo(c,m),t.bezierCurveTo(c,m-_,w-v,f,w,f),t.bezierCurveTo(w+v,f,g,m-_,g,m),t.bezierCurveTo(g,m+_,w+v,y,w,y),t.bezierCurveTo(w-v,y,c,m+_,c,m),t.closePath(),t.stroke()}},Object.defineProperties(v.prototype,_);var g=function(t){this._data=t},y={data:{configurable:!0}};g.prototype.getData=function(){throw new Error("Method not implemented.")},y.data.get=function(){return this._data},g.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,s=i.height,a=o(e,function(e){n._data.positions.push(e.relativePosition),t.clearRect(0,0,r,s),n.render(t)});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},g.prototype.render=function(t){var e=this._data,n=e.drawOption,i=n.color,r=n.thickness,o=n.lineCap,s=e.positions;if(!(s.length<2)){var a=t.canvas,u=a.width,h=a.height,c=s[0],f=s[s.length-1];o&&(t.lineCap=o),i&&(t.fillStyle=i);var l=c.x*u,p=c.y*h,d=f.x*u-l,v=f.y*h-p,_=Math.sqrt(d*d+v*v),g=v/_,y=d/_,w=[],m=[0,r/2,-(9+r),r/2,-(12+1.2*r),5+r];t.beginPath(),w.push(0,0),w.push(m[0]<0?_+m[0]:m[0],m[1]),w.push(Math.max(m[2]<0?_+m[2]:m[2],0),m[3]),w.push(Math.max(m[4]<0?_+m[4]:m[4],-3),m[5]),w.push(Math.max(_,12),0),w.push(Math.max(m[4]<0?_+m[4]:m[4],-3),-m[5]),w.push(Math.max(m[2]<0?_+m[2]:m[2],0),-m[3]),w.push(m[0]<0?_+m[0]:m[0],-m[1]),w.push(0,0);for(var b=0;b<w.length;b+=2){var O=w[b]*y-w[b+1]*g+l,P=w[b]*g+w[b+1]*y+p;0===b?t.moveTo(O,P):t.lineTo(O,P)}t.fill()}},Object.defineProperties(g.prototype,y);var w=function(t){var e=t.canvas,n=t.width,i=t.height,r=t.drawMouse;void 0===r&&(r=!0);var o=t.type;void 0===o&&(o="freeLine");var s=t.color;void 0===s&&(s="red");var a=t.thickness;void 0===a&&(a=3);var h=t.lineCap;void 0===h&&(h="square");var c=t.figures;if(void 0===c&&(c=[]),this.disableMouseDrawing=function(){},this._figures=[],this._cursor=0,this._canvas=e,!(this._ctx=e.getContext("2d")))throw new Error("2d context not supported");n&&(e.width=n),i&&(e.height=i),this._tmpCanvas=document.createElement("canvas"),this._tmpCtx=this._tmpCanvas.getContext("2d"),this._drawOption={type:o,color:s,thickness:a,lineCap:h},this._emitter=new u,r&&this.enableMouseDrawing();for(var f=0,l=c;f<l.length;f+=1)this.draw(l[f])},m={drawOption:{configurable:!0},canvas:{configurable:!0},figures:{configurable:!0},size:{configurable:!0}};function b(t,e,n){return t.addEventListener(e,n),function(){return t.removeEventListener(e,n)}}function O(t,e){switch(void 0===e&&(e=[]),t.type){case"freeLine":return new h({drawOption:t,positions:e});case"straightLine":return new f({drawOption:t,positions:e});case"arrow":return new g({drawOption:t,positions:e});case"rectangle":return new p({drawOption:t,positions:e});case"ellipse":return new v({drawOption:t,positions:e});default:throw new Error('There is no figure of "'+t.type+'" type.')}}function P(t,e,n){var i=e.clientX,r=e.clientY,o=t.getBoundingClientRect(),s=o.width,a=o.height,u=n.thickness,h=i-o.left,c=r-o.top;return"freeLine"===n.type?{x:Number(h/s),y:Number(c/a)}:{x:Number((h<0?0+u/2:h>s?s-u/2:h)/s),y:Number((c<0?0+u/2:c>a?a-u/2:c)/a)}}function x(){}m.drawOption.get=function(){return this._drawOption},m.canvas.get=function(){return this._canvas},m.figures.get=function(){return this._figures.map(function(t){return t.data})},m.size.get=function(){return{width:this._canvas.width,height:this._canvas.height}},w.prototype.on=function(t,e){return this._emitter.on(t,e)},w.prototype.setSize=function(t){var e=t.width,n=t.height;e&&(this._canvas.width=e),n&&(this._canvas.height=n)},w.prototype.setOptions=function(t){this._drawOption=Object.assign({},this._drawOption,t)},w.prototype.draw=function(t){var e=O(t.drawOption,t.positions);this._push(e),e.render(this._ctx)},w.prototype.undo=function(){this._cursor>0&&(this._cursor--,this.redraw())},w.prototype.redo=function(){this._cursor<this._figures.length&&(this._cursor++,this.redraw())},w.prototype.clear=function(){var t=this.size;this._ctx.clearRect(0,0,t.width,t.height),this.setFigures([])},w.prototype.allOff=function(){this._emitter.allOff()},w.prototype.destroy=function(){this.disableMouseDrawing(),this._emitter.allOff()},w.prototype.enableMouseDrawing=function(){var i=this;this.disableMouseDrawing();var r=this.canvas,o=null,s=x,u=function(u,h){var c,f,l,p,d,v,_;o=O(i._drawOption),f=i._tmpCanvas,p=(l=(c=r).getBoundingClientRect()).top,d=l.left,v=l.width,_=l.height,Object.assign(f,{width:c.width,height:c.height}),Object.assign(f.style,{position:"fixed",top:p+(v-c.width)/2+"px",left:d+(_-c.height)/2+"px"}),document.body.appendChild(i._tmpCanvas),o.drawing(i._tmpCtx,new a(function(i){var r,o=function(i,r,o){for(var s;;){var a=i();if(n(a)&&(a=a.v),!a)return u;if(a.then){s=0;break}var u=o();if(u&&u.then){if(!n(u)){s=1;break}u=u.s}if(r){var h=r();if(h&&h.then&&!n(h)){s=2;break}}}var c=new t,f=e.bind(null,c,2);return(0===s?a.then(p):1===s?u.then(l):h.then(d)).then(void 0,f),c;function l(t){u=t;do{if(r&&(h=r())&&h.then&&!n(h))return void h.then(d).then(void 0,f);if(!(a=i())||n(a)&&!a.v)return void e(c,1,u);if(a.then)return void a.then(p).then(void 0,f);n(u=o())&&(u=u.v)}while(!u||!u.then);u.then(l).then(void 0,f)}function p(t){t?(u=o())&&u.then?u.then(l).then(void 0,f):l(u):e(c,1,u)}function d(){(a=i())?a.then?a.then(p).then(void 0,f):p(a):e(c,1,u)}}(function(){return!!Promise.resolve(new Promise(function(t){return s=t})).then(function(t){return r=t})},void 0,function(){return i._yield(r).then(function(){})});if(o&&o.then)return o.then(function(){})})),i._emitter.emit("drawStart",{originalEvent:h,canvas:i._canvas,relativePosition:u})},h=function(t,e){if(o){var n={originalEvent:e,canvas:i._canvas,relativePosition:t};s(n),i._emitter.emit("drawing",n)}},c=function(t,e){o&&(document.body.removeChild(i._tmpCanvas),s(),i._ctx.drawImage(i._tmpCanvas,0,0),i._push(o),s=x,o=null,i._emitter.emit("drawEnd",{originalEvent:e,canvas:i._canvas,relativePosition:t}))},f=null,l=[b(r,"mousedown",function(t){var e=P(r,t,i._drawOption);u(e,t),h(e,t)}),b(r,"touchstart",function(t){var e=P(r,f=t.touches[0],i._drawOption);u(e,t),h(e,t)}),b(document,"mousemove",function(t){h(P(r,t,i._drawOption),t)}),b(document,"touchmove",function(t){h(P(r,f=t.touches[0],i._drawOption),t)}),b(document,"mouseup",function(t){c(P(r,t,i._drawOption),t)}),b(r,"touchend",function(t){c(P(r,f,i._drawOption),t)})];this.disableMouseDrawing=function(){return l.forEach(function(t){return t()})}},w.prototype.redraw=function(){var t=this.size;this._ctx.clearRect(0,0,t.width,t.height);for(var e=0,n=this._figures.slice(0,this._cursor);e<n.length;e+=1)n[e].render(this._ctx)},w.prototype.setFigures=function(t){void 0===t&&(t=[]),this._figures=[],this._cursor=0;for(var e=0,n=t;e<n.length;e+=1)this.draw(n[e])},w.prototype._push=function(t){(this._figures=this._figures.slice(0,this._cursor++)).push(t),this._emitter.emit("figures",this.figures)},Object.defineProperties(w.prototype,m);export default w;export{w as Painter};
//# sourceMappingURL=index.mjs.map

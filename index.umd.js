!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.simplePainter={})}(this,function(t){const e=function(){function t(){}return t.prototype.then=function(e,i){const r=new t,o=this.s;if(o){const t=1&o?e:i;if(t){try{n(r,1,t(this.v))}catch(t){n(r,2,t)}return r}return this}return this.o=function(t){try{const o=t.v;1&t.s?n(r,1,e?e(o):o):i?n(r,1,i(o)):n(r,2,o)}catch(t){n(r,2,t)}},r},t}();function n(t,i,r){if(!t.s){if(r instanceof e){if(!r.s)return void(r.o=n.bind(null,t,i));1&i&&(i=r.s),r=r.v}if(r&&r.then)return void r.then(n.bind(null,t,i),n.bind(null,t,2));t.s=i,t.v=r;const o=t.o;o&&o(t)}}function i(t){return t instanceof e&&1&t.s}const r="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator",o="undefined"!=typeof Symbol?Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")):"@@asyncIterator";function s(t,s,a){if("function"==typeof t[o]){var u=new e,h=t[o]();return h.next().then(f).then(void 0,l),u;function c(t){if(a&&a())return n(u,1,h.return?h.return().then(function(){return t}):t);h.next().then(f).then(void 0,l)}function f(t){t.done?n(u,1):Promise.resolve(s(t.value)).then(c).then(void 0,l)}function l(t){n(u,2,h.return?h.return().then(function(){return t}):t)}}return Promise.resolve(function(t,o,s){if("function"==typeof t[r]){var a,u,h,c=t[r]();if(function t(r){try{for(;!((a=c.next()).done||s&&s());)if((r=o(a.value))&&r.then){if(!i(r))return void r.then(t,h||(h=n.bind(null,u=new e,2)));r=r.v}u?n(u,1,r):u=r}catch(t){n(u||(u=new e),2,t)}}(),c.return){var f=function(t){try{a.done||c.return()}catch(t){}return t};if(u&&u.then)return u.then(f,function(t){throw f(t)});f()}return u}if(!("length"in t))throw new TypeError("Object is not iterable");for(var l=[],p=0;p<t.length;p++)l.push(t[p]);return function(t,r,o){var s,a,u=-1;return function h(c){try{for(;++u<t.length&&(!o||!o());)if((c=r(u))&&c.then){if(!i(c))return void c.then(h,a||(a=n.bind(null,s=new e,2)));c=c.v}s?n(s,1,c):s=c}catch(t){n(s||(s=new e),2,t)}}(),s}(l,function(t){return o(l[t])},s)}(t,function(t){return Promise.resolve(t).then(s)},a))}const a={},u=function(){function t(t){this._entry=t,this._pact=null,this._resolve=null,this._return=null,this._promise=null}function i(t){return{value:t,done:!0}}function r(t){return{value:t,done:!1}}return t.prototype._yield=function(t){return this._resolve(t&&t.then?t.then(r):r(t)),this._pact=new e},t.prototype.next=function(t){const r=this;return r._promise=new Promise(function(o){const s=r._pact;if(null===s){const t=r._entry;if(null===t)return o(r._promise);function u(t){r._resolve(t&&t.then?t.then(i):i(t)),r._pact=null,r._resolve=null}r._entry=null,r._resolve=o;var h=t(r);h&&h.then?h.then(u,function(t){if(t===a)u(r._return);else{const n=new e;r._resolve(n),r._pact=null,r._resolve=null,_resolve(n,2,t)}}):u(h)}else r._pact=null,r._resolve=o,n(s,1,t)})},t.prototype.return=function(t){const e=this;return e._promise=new Promise(function(r){const o=e._pact;if(null===o)return null===e._entry?r(e._promise):(e._entry=null,r(t&&t.then?t.then(i):i(t)));e._return=t,e._resolve=r,e._pact=null,n(o,2,a)})},t.prototype.throw=function(t){const e=this;return e._promise=new Promise(function(i,r){const o=e._pact;if(null===o)return null===e._entry?i(e._promise):(e._entry=null,r(t));e._resolve=i,e._pact=null,n(o,2,t)})},t.prototype[o]=function(){return this},t}();var h=function(){this._events={}};h.prototype.emit=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=this._events[t]||[];i<r.length;i+=1)r[i].apply(void 0,e)},h.prototype.on=function(t,e){var n=this;return(this._events[t]=this._events[t]||[]).push(e),function(){return n._events[t]=n._events[t].filter(function(t){return t!==e})}},h.prototype.allOff=function(){this._events={}};var c=function(t){this._data=t},f={data:{configurable:!0}};f.data.get=function(){return this._data},c.prototype.drawing=function(t,e){try{var n=this,i=n._data.drawOption,r=i.color,o=i.thickness,a=i.lineCap,u=t.canvas,h=u.width,c=u.height;r&&(t.strokeStyle=r),o&&(t.lineWidth=o),a&&(t.lineCap=a),t.beginPath();var f=s(e,function(e){var i=e.relativePosition,r=i.x,o=i.y;n._data.positions.length?(t.lineTo(h*r,c*o),t.stroke()):t.moveTo(h*r,c*o),n._data.positions.push({x:r,y:o})});return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},c.prototype.render=function(t){if(this._data.positions.length){var e=this._data.drawOption,n=e.color,i=e.thickness,r=e.lineCap,o=t.canvas,s=o.width,a=o.height;n&&(t.strokeStyle=n),i&&(t.lineWidth=i),r&&(t.lineCap=r),t.beginPath();for(var u=0,h=this._data.positions;u<h.length;u+=1){var c=h[u];t.lineTo(s*c.x,a*c.y),t.stroke()}}},Object.defineProperties(c.prototype,f);var l=function(t){this._data=t},p={data:{configurable:!0}};p.data.get=function(){return this._data},l.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,o=i.height,a=s(e,function(e){n._data.positions.push(e.relativePosition),t.clearRect(0,0,r,o),n.render(t)});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},l.prototype.render=function(t){var e=this._data,n=e.drawOption,i=n.color,r=n.thickness,o=n.lineCap,s=e.positions;if(!(s.length<2)){var a=t.canvas,u=a.width,h=a.height,c=s[0],f=c.x,l=c.y,p=s[s.length-1],d=p.x,v=p.y;i&&(t.strokeStyle=i),r&&(t.lineWidth=r),o&&(t.lineCap=o),t.beginPath(),t.moveTo(f*u,l*h),t.lineTo(d*u,v*h),t.stroke()}},Object.defineProperties(l.prototype,p);var d=function(t){this._data=t},v={data:{configurable:!0}};v.data.get=function(){return this._data},d.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,o=i.height,a=s(e,function(e){n._data.positions.push(e.relativePosition),t.clearRect(0,0,r,o),n.render(t)});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},d.prototype.render=function(t){var e=this._data,n=e.drawOption,i=n.color,r=n.thickness,o=n.lineCap,s=e.positions;if(!(s.length<2)){var a=t.canvas,u=a.width,h=a.height,c=s[0],f=c.x,l=c.y,p=s[s.length-1],d=p.x,v=p.y;i&&(t.strokeStyle=i),r&&(t.lineWidth=r),o&&(t.lineCap=o),t.strokeRect(f*u,l*h,(d-f)*u,(v-l)*h)}},Object.defineProperties(d.prototype,v);var _=function(t){this._data=t},g={data:{configurable:!0}};g.data.get=function(){return this._data},_.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,o=i.height,a=s(e,function(e){n._data.positions.push(e.relativePosition),t.clearRect(0,0,r,o),n.render(t)});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},_.prototype.render=function(t){var e=this._data,n=e.drawOption,i=n.color,r=n.thickness,o=n.lineCap,s=e.positions;if(!(s.length<2)){var a=t.canvas,u=s[0],h=s[s.length-1];i&&(t.strokeStyle=i),r&&(t.lineWidth=r),o&&(t.lineCap=o),t.beginPath();var c=u.x*a.width,f=u.y*a.height,l=h.x*a.width-c,p=h.y*a.height-f,d=4*(Math.sqrt(2)-1)/3,v=l/2*d,_=p/2*d,g=c+l,y=f+p,w=c+l/2,m=f+p/2;t.beginPath(),t.moveTo(c,m),t.bezierCurveTo(c,m-_,w-v,f,w,f),t.bezierCurveTo(w+v,f,g,m-_,g,m),t.bezierCurveTo(g,m+_,w+v,y,w,y),t.bezierCurveTo(w-v,y,c,m+_,c,m),t.closePath(),t.stroke()}},Object.defineProperties(_.prototype,g);var y=function(t){this._data=t},w={data:{configurable:!0}};y.prototype.getData=function(){throw new Error("Method not implemented.")},w.data.get=function(){return this._data},y.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,o=i.height,a=s(e,function(e){n._data.positions.push(e.relativePosition),t.clearRect(0,0,r,o),n.render(t)});return Promise.resolve(a&&a.then?a.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},y.prototype.render=function(t){var e=this._data,n=e.drawOption,i=n.color,r=n.thickness,o=n.lineCap,s=e.positions;if(!(s.length<2)){var a=t.canvas,u=a.width,h=a.height,c=s[0],f=s[s.length-1];o&&(t.lineCap=o),i&&(t.fillStyle=i);var l=c.x*u,p=c.y*h,d=f.x*u-l,v=f.y*h-p,_=Math.sqrt(d*d+v*v),g=v/_,y=d/_,w=[],m=[0,r/2,-(9+r),r/2,-(12+1.2*r),5+r];t.beginPath(),w.push(0,0),w.push(m[0]<0?_+m[0]:m[0],m[1]),w.push(Math.max(m[2]<0?_+m[2]:m[2],0),m[3]),w.push(Math.max(m[4]<0?_+m[4]:m[4],-3),m[5]),w.push(Math.max(_,12),0),w.push(Math.max(m[4]<0?_+m[4]:m[4],-3),-m[5]),w.push(Math.max(m[2]<0?_+m[2]:m[2],0),-m[3]),w.push(m[0]<0?_+m[0]:m[0],-m[1]),w.push(0,0);for(var b=0;b<w.length;b+=2){var P=w[b]*y-w[b+1]*g+l,O=w[b]*g+w[b+1]*y+p;0===b?t.moveTo(P,O):t.lineTo(P,O)}t.fill()}},Object.defineProperties(y.prototype,w);var m=function(t){var e=t.canvas,n=t.width,i=t.height,r=t.drawMouse;void 0===r&&(r=!0);var o=t.type;void 0===o&&(o="freeLine");var s=t.color;void 0===s&&(s="red");var a=t.thickness;void 0===a&&(a=3);var u=t.lineCap;void 0===u&&(u="square");var c=t.figures;if(void 0===c&&(c=[]),this.disableMouseDrawing=function(){},this._figures=[],this._cursor=0,this._canvas=e,!(this._ctx=e.getContext("2d")))throw new Error("2d context not supported");n&&(e.width=n),i&&(e.height=i),this._tmpCanvas=document.createElement("canvas"),this._tmpCtx=this._tmpCanvas.getContext("2d"),this._drawOption={type:o,color:s,thickness:a,lineCap:u},this._emitter=new h,r&&this.enableMouseDrawing();for(var f=0,l=c;f<l.length;f+=1)this.draw(l[f])},b={drawOption:{configurable:!0},canvas:{configurable:!0},figures:{configurable:!0},size:{configurable:!0}};function P(t,e,n){return t.addEventListener(e,n),function(){return t.removeEventListener(e,n)}}function O(t,e){switch(void 0===e&&(e=[]),t.type){case"freeLine":return new c({drawOption:t,positions:e});case"straightLine":return new l({drawOption:t,positions:e});case"arrow":return new y({drawOption:t,positions:e});case"rectangle":return new d({drawOption:t,positions:e});case"ellipse":return new _({drawOption:t,positions:e});default:throw new Error('There is no figure of "'+t.type+'" type.')}}function x(t,e,n){var i=e.clientX,r=e.clientY,o=t.getBoundingClientRect(),s=o.width,a=o.height,u=n.thickness,h=i-o.left,c=r-o.top;return"freeLine"===n.type?{x:Number(h/s),y:Number(c/a)}:{x:Number((h<0?0+u/2:h>s?s-u/2:h)/s),y:Number((c<0?0+u/2:c>a?a-u/2:c)/a)}}function C(){}b.drawOption.get=function(){return this._drawOption},b.canvas.get=function(){return this._canvas},b.figures.get=function(){return this._figures.map(function(t){return t.data})},b.size.get=function(){return{width:this._canvas.width,height:this._canvas.height}},m.prototype.on=function(t,e){return this._emitter.on(t,e)},m.prototype.setSize=function(t){var e=t.width,n=t.height;e&&(this._canvas.width=e),n&&(this._canvas.height=n)},m.prototype.setOptions=function(t){this._drawOption=Object.assign({},this._drawOption,t)},m.prototype.draw=function(t){var e=O(t.drawOption,t.positions);this._push(e),e.render(this._ctx)},m.prototype.undo=function(){this._cursor>0&&(this._cursor--,this.redraw())},m.prototype.redo=function(){this._cursor<this._figures.length&&(this._cursor++,this.redraw())},m.prototype.clear=function(){var t=this.size;this._ctx.clearRect(0,0,t.width,t.height),this.setFigures([])},m.prototype.allOff=function(){this._emitter.allOff()},m.prototype.destroy=function(){this.disableMouseDrawing(),this._emitter.allOff()},m.prototype.enableMouseDrawing=function(){var t=this;this.disableMouseDrawing();var r=this.canvas,o=null,s=C,a=function(a,h){var c,f,l,p,d,v,_;o=O(t._drawOption),f=t._tmpCanvas,p=(l=(c=r).getBoundingClientRect()).top,d=l.left,v=l.width,_=l.height,Object.assign(f,{width:c.width,height:c.height}),Object.assign(f.style,{position:"fixed",top:p+(v-c.width)/2+"px",left:d+(_-c.height)/2+"px"}),document.body.appendChild(t._tmpCanvas),o.drawing(t._tmpCtx,new u(function(t){var r,o=function(t,r,o){for(var s;;){var a=t();if(i(a)&&(a=a.v),!a)return u;if(a.then){s=0;break}var u=o();if(u&&u.then){if(!i(u)){s=1;break}u=u.s}if(r){var h=r();if(h&&h.then&&!i(h)){s=2;break}}}var c=new e,f=n.bind(null,c,2);return(0===s?a.then(p):1===s?u.then(l):h.then(d)).then(void 0,f),c;function l(e){u=e;do{if(r&&(h=r())&&h.then&&!i(h))return void h.then(d).then(void 0,f);if(!(a=t())||i(a)&&!a.v)return void n(c,1,u);if(a.then)return void a.then(p).then(void 0,f);i(u=o())&&(u=u.v)}while(!u||!u.then);u.then(l).then(void 0,f)}function p(t){t?(u=o())&&u.then?u.then(l).then(void 0,f):l(u):n(c,1,u)}function d(){(a=t())?a.then?a.then(p).then(void 0,f):p(a):n(c,1,u)}}(function(){return!!Promise.resolve(new Promise(function(t){return s=t})).then(function(t){return r=t})},void 0,function(){return t._yield(r).then(function(){})});if(o&&o.then)return o.then(function(){})})),t._emitter.emit("drawStart",{originalEvent:h,canvas:t._canvas,relativePosition:a})},h=function(e,n){if(o){var i={originalEvent:n,canvas:t._canvas,relativePosition:e};s(i),t._emitter.emit("drawing",i)}},c=function(e,n){o&&(document.body.removeChild(t._tmpCanvas),s(),t._ctx.drawImage(t._tmpCanvas,0,0),t._push(o),s=C,o=null,t._emitter.emit("drawEnd",{originalEvent:n,canvas:t._canvas,relativePosition:e}))},f=null,l=[P(r,"mousedown",function(e){var n=x(r,e,t._drawOption);a(n,e),h(n,e)}),P(r,"touchstart",function(e){var n=x(r,f=e.touches[0],t._drawOption);a(n,e),h(n,e)}),P(document,"mousemove",function(e){h(x(r,e,t._drawOption),e)}),P(document,"touchmove",function(e){h(x(r,f=e.touches[0],t._drawOption),e)}),P(document,"mouseup",function(e){c(x(r,e,t._drawOption),e)}),P(r,"touchend",function(e){c(x(r,f,t._drawOption),e)})];this.disableMouseDrawing=function(){return l.forEach(function(t){return t()})}},m.prototype.redraw=function(){var t=this.size;this._ctx.clearRect(0,0,t.width,t.height);for(var e=0,n=this._figures.slice(0,this._cursor);e<n.length;e+=1)n[e].render(this._ctx)},m.prototype.setFigures=function(t){void 0===t&&(t=[]),this._figures=[],this._cursor=0;for(var e=0,n=t;e<n.length;e+=1)this.draw(n[e])},m.prototype._push=function(t){(this._figures=this._figures.slice(0,this._cursor++)).push(t),this._emitter.emit("figures",this.figures)},Object.defineProperties(m.prototype,b),t.default=m,t.Painter=m});
//# sourceMappingURL=index.umd.js.map

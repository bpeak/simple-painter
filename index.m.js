const t=function(){function t(){}return t.prototype.then=function(n,i){const r=new t,o=this.s;if(o){const t=1&o?n:i;if(t){try{e(r,1,t(this.v))}catch(t){e(r,2,t)}return r}return this}return this.o=function(t){try{const o=t.v;1&t.s?e(r,1,n?n(o):o):i?e(r,1,i(o)):e(r,2,o)}catch(t){e(r,2,t)}},r},t}();function e(n,i,r){if(!n.s){if(r instanceof t){if(!r.s)return void(r.o=e.bind(null,n,i));1&i&&(i=r.s),r=r.v}if(r&&r.then)return void r.then(e.bind(null,n,i),e.bind(null,n,2));n.s=i,n.v=r;const o=n.o;o&&o(n)}}function n(e){return e instanceof t&&1&e.s}const i="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator",r="undefined"!=typeof Symbol?Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")):"@@asyncIterator";function o(o,s,h){if("function"==typeof o[r]){var a=new t,u=o[r]();return u.next().then(l).then(void 0,v),a;function c(t){if(h&&h())return e(a,1,u.return?u.return().then(function(){return t}):t);u.next().then(l).then(void 0,v)}function l(t){t.done?e(a,1):Promise.resolve(s(t.value)).then(c).then(void 0,v)}function v(t){e(a,2,u.return?u.return().then(function(){return t}):t)}}return Promise.resolve(function(r,o,s){if("function"==typeof r[i]){var h,a,u,c=r[i]();if(function i(r){try{for(;!((h=c.next()).done||s&&s());)if((r=o(h.value))&&r.then){if(!n(r))return void r.then(i,u||(u=e.bind(null,a=new t,2)));r=r.v}a?e(a,1,r):a=r}catch(n){e(a||(a=new t),2,n)}}(),c.return){var l=function(t){try{h.done||c.return()}catch(t){}return t};if(a&&a.then)return a.then(l,function(t){throw l(t)});l()}return a}if(!("length"in r))throw new TypeError("Object is not iterable");for(var v=[],f=0;f<r.length;f++)v.push(r[f]);return function(i,r,o){var s,h,a=-1;return function u(c){try{for(;++a<i.length&&(!o||!o());)if((c=r(a))&&c.then){if(!n(c))return void c.then(u,h||(h=e.bind(null,s=new t,2)));c=c.v}s?e(s,1,c):s=c}catch(n){e(s||(s=new t),2,n)}}(),s}(v,function(t){return o(v[t])},s)}(o,function(t){return Promise.resolve(t).then(s)},h))}const s={},h=function(){function n(t){this._entry=t,this._pact=null,this._resolve=null,this._return=null,this._promise=null}function i(t){return{value:t,done:!0}}function o(t){return{value:t,done:!1}}return n.prototype._yield=function(e){return this._resolve(e&&e.then?e.then(o):o(e)),this._pact=new t},n.prototype.next=function(n){const r=this;return r._promise=new Promise(function(o){const h=r._pact;if(null===h){const e=r._entry;if(null===e)return o(r._promise);function a(t){r._resolve(t&&t.then?t.then(i):i(t)),r._pact=null,r._resolve=null}r._entry=null,r._resolve=o;var u=e(r);u&&u.then?u.then(a,function(e){if(e===s)a(r._return);else{const n=new t;r._resolve(n),r._pact=null,r._resolve=null,_resolve(n,2,e)}}):a(u)}else r._pact=null,r._resolve=o,e(h,1,n)})},n.prototype.return=function(t){const n=this;return n._promise=new Promise(function(r){const o=n._pact;if(null===o)return null===n._entry?r(n._promise):(n._entry=null,r(t&&t.then?t.then(i):i(t)));n._return=t,n._resolve=r,n._pact=null,e(o,2,s)})},n.prototype.throw=function(t){const n=this;return n._promise=new Promise(function(i,r){const o=n._pact;if(null===o)return null===n._entry?i(n._promise):(n._entry=null,r(t));n._resolve=i,n._pact=null,e(o,2,t)})},n.prototype[r]=function(){return this},n}();var a=function(){this._events={}};a.prototype.emit=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var i=0,r=this._events[t]||[];i<r.length;i+=1)r[i].apply(void 0,e)},a.prototype.on=function(t,e){var n=this;return(this._events[t]=this._events[t]||[]).push(e),function(){return n._events[t]=n._events[t].filter(function(t){return t!==e})}},a.prototype.allOff=function(){this._events={}};var u=function(t,e){this._style=t,this._positions=e};u.prototype.drawing=function(t,e){try{var n=this,i=n._style,r=i.color,s=i.thickness,h=i.lineCap,a=t.canvas,u=a.width,c=a.height;r&&(t.strokeStyle=r),s&&(t.lineWidth=s),h&&(t.lineCap=h),n._positions=[],t.beginPath();var l=o(e,function(e){var i=e.relativePosition,r=i.x,o=i.y;n._positions.length?(t.lineTo(u*r,c*o),t.stroke()):t.moveTo(u*r,c*o),n._positions.push({x:r,y:o})});return Promise.resolve(l&&l.then?l.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},u.prototype.render=function(t){if(this._positions){var e=this._style,n=e.color,i=e.thickness,r=e.lineCap,o=t.canvas,s=o.width,h=o.height;n&&(t.strokeStyle=n),i&&(t.lineWidth=i),r&&(t.lineCap=r),t.beginPath();for(var a=0,u=this._positions;a<u.length;a+=1){var c=u[a];t.lineTo(s*c.x,h*c.y),t.stroke()}}};var c=function(t,e,n){this._style=t,this._start=e,this._end=n};c.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,s=i.height,h=o(e,function(e){var i=e.relativePosition;n._start?n._end=i:n._start=n._end=i,t.clearRect(0,0,r,s),n.render(t)});return Promise.resolve(h&&h.then?h.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},c.prototype.render=function(t){if(void 0!==this._start&&void 0!==this._end){var e=this._style,n=e.color,i=e.thickness,r=e.lineCap,o=t.canvas,s=o.width,h=o.height;n&&(t.strokeStyle=n),i&&(t.lineWidth=i),r&&(t.lineCap=r);var a=this._start,u=a.x,c=a.y,l=this._end,v=l.x,f=l.y;t.beginPath(),t.moveTo(u*s,c*h),t.lineTo(v*s,f*h),t.stroke()}};var l=function(t,e,n){this._style=t,this._start=e,this._end=n};l.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,s=i.height,h=o(e,function(e){var i=e.relativePosition;n._start?n._end=i:n._start=n._end=i,t.clearRect(0,0,r,s),n.render(t)});return Promise.resolve(h&&h.then?h.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},l.prototype.render=function(t){if(void 0!==this._start&&void 0!==this._end){var e=this._style,n=e.color,i=e.thickness,r=e.lineCap,o=t.canvas,s=o.width,h=o.height;n&&(t.strokeStyle=n),i&&(t.lineWidth=i),r&&(t.lineCap=r);var a=this._start,u=a.x,c=a.y,l=this._end;t.strokeRect(u*s,c*h,(l.x-u)*s,(l.y-c)*h)}};var v=function(t,e,n){this._style=t,this._start=e,this._end=n};v.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,s=i.height,h=o(e,function(e){var i=e.relativePosition;n._start?n._end=i:n._start=n._end=i,t.clearRect(0,0,r,s),n.render(t)});return Promise.resolve(h&&h.then?h.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},v.prototype.render=function(t){if(void 0!==this._start&&void 0!==this._end){var e=this._style,n=e.color,i=e.thickness,r=e.lineCap,o=t.canvas;n&&(t.strokeStyle=n),i&&(t.lineWidth=i),r&&(t.lineCap=r),t.beginPath();var s=this._start,h=this._end,a=s.x*o.width,u=s.y*o.height,c=h.x*o.width-a,l=h.y*o.height-u,v=4*(Math.sqrt(2)-1)/3,f=c/2*v,d=l/2*v,p=a+c,_=u+l,y=a+c/2,w=u+l/2;t.beginPath(),t.moveTo(a,w),t.bezierCurveTo(a,w-d,y-f,u,y,u),t.bezierCurveTo(y+f,u,p,w-d,p,w),t.bezierCurveTo(p,w+d,y+f,_,y,_),t.bezierCurveTo(y-f,_,a,w+d,a,w),t.closePath(),t.stroke()}};var f=function(t,e,n){this._style=t,this._start=e,this._end=n};f.prototype.drawing=function(t,e){try{var n=this,i=t.canvas,r=i.width,s=i.height,h=o(e,function(e){var i=e.relativePosition;n._start?n._end=i:n._start=n._end=i,t.clearRect(0,0,r,s),n.render(t)});return Promise.resolve(h&&h.then?h.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},f.prototype.render=function(t){if(void 0!==this._start&&void 0!==this._end){var e=this._style,n=e.color,i=e.thickness;void 0===i&&(i=3);var r=e.lineCap,o=t.canvas,s=o.width,h=o.height;r&&(t.lineCap=r),n&&(t.fillStyle=n);var a=this._start.x*s,u=this._start.y*h,c=[0,i/2,-12,i/2,-15,8],l=this._end.x*s-a,v=this._end.y*h-u,f=Math.sqrt(l*l+v*v),d=v/f,p=l/f,_=[];t.beginPath(),_.push(0,0),_.push(c[0]<0?f+c[0]:c[0],c[1]),_.push(Math.max(c[2]<0?f+c[2]:c[2],0),c[3]),_.push(Math.max(c[4]<0?f+c[4]:c[4],-3),c[5]),_.push(Math.max(f,12),0),_.push(Math.max(c[4]<0?f+c[4]:c[4],-3),-c[5]),_.push(Math.max(c[2]<0?f+c[2]:c[2],0),-c[3]),_.push(c[0]<0?f+c[0]:c[0],-c[1]),_.push(0,0);for(var y=0;y<_.length;y+=2){var w=_[y]*p-_[y+1]*d+a,m=_[y]*d+_[y+1]*p+u;0===y?t.moveTo(w,m):t.lineTo(w,m)}t.fill()}};var d=function(t){var e=t.canvas,n=t.width,i=t.height,r=t.drawMouse;void 0===r&&(r=!0);var o=t.type;void 0===o&&(o="freeLine");var s=t.color;void 0===s&&(s="red");var h=t.thickness;void 0===h&&(h=3);var u=t.lineCap;if(void 0===u&&(u="square"),this.disableMouseDrawing=function(){},this._figures=[],this._cursor=0,this._canvas=e,!(this._ctx=e.getContext("2d")))throw new Error("2d context not supported");n&&(e.width=n),i&&(e.height=i),this._tmpCanvas=document.createElement("canvas"),this._tmpCtx=this._tmpCanvas.getContext("2d"),this._drawOption={type:o,color:s,thickness:h,lineCap:u},this._emitter=new a,r&&this.enableMouseDrawing()},p={drawOption:{configurable:!0},canvas:{configurable:!0},size:{configurable:!0}};function _(t,e,n){return t.addEventListener(e,n),function(){return t.removeEventListener(e,n)}}function y(t,e){var n=e.clientX,i=e.clientY,r=t.getBoundingClientRect(),o=r.top,s=r.height;return{x:Number((n-r.left)/r.width),y:Number((i-o)/s)}}function w(){}p.drawOption.get=function(){return this._drawOption},p.canvas.get=function(){return this._canvas},p.size.get=function(){return{width:this._canvas.width,height:this._canvas.height}},d.prototype.on=function(t,e){return this._emitter.on(t,e)},d.prototype.setSize=function(t){var e=t.width,n=t.height;e&&(this._canvas.width=e),n&&(this._canvas.height=n)},d.prototype.setOptions=function(t){this._drawOption=Object.assign({},this._drawOption,t)},d.prototype.draw=function(t){this._push(t),t.render(this._ctx)},d.prototype.undo=function(){this._cursor>0&&(this._cursor--,this.redraw())},d.prototype.redo=function(){this._cursor<this._figures.length&&(this._cursor++,this.redraw())},d.prototype.clear=function(){var t=this.size;this._ctx.clearRect(0,0,t.width,t.height)},d.prototype.destroy=function(){this.disableMouseDrawing(),this._emitter.allOff()},d.prototype.enableMouseDrawing=function(){var i=this;this.disableMouseDrawing();var r=this.canvas,o=null,s=w,a=function(a,d){switch(i._drawOption.type){case"freeLine":o=new u(i._drawOption);break;case"straightLine":o=new c(i._drawOption);break;case"arrow":o=new f(i._drawOption);break;case"rectangle":o=new l(i._drawOption);break;case"ellipse":o=new v(i._drawOption);break;default:throw new Error('There is no figure of "'+i._drawOption.type+'" type.')}var p,_,y,w,m,g,b;_=i._tmpCanvas,w=(y=(p=r).getBoundingClientRect()).top,m=y.left,g=y.width,b=y.height,Object.assign(_,{width:p.width,height:p.height}),Object.assign(_.style,{position:"fixed",top:w+(g-p.width)/2+"px",left:m+(b-p.height)/2+"px"}),document.body.appendChild(i._tmpCanvas),o.drawing(i._tmpCtx,new h(function(i){var r,o=function(i,r,o){for(var s;;){var h=i();if(n(h)&&(h=h.v),!h)return a;if(h.then){s=0;break}var a=o();if(a&&a.then){if(!n(a)){s=1;break}a=a.s}if(r){var u=r();if(u&&u.then&&!n(u)){s=2;break}}}var c=new t,l=e.bind(null,c,2);return(0===s?h.then(f):1===s?a.then(v):u.then(d)).then(void 0,l),c;function v(t){a=t;do{if(r&&(u=r())&&u.then&&!n(u))return void u.then(d).then(void 0,l);if(!(h=i())||n(h)&&!h.v)return void e(c,1,a);if(h.then)return void h.then(f).then(void 0,l);n(a=o())&&(a=a.v)}while(!a||!a.then);a.then(v).then(void 0,l)}function f(t){t?(a=o())&&a.then?a.then(v).then(void 0,l):v(a):e(c,1,a)}function d(){(h=i())?h.then?h.then(f).then(void 0,l):f(h):e(c,1,a)}}(function(){return!!Promise.resolve(new Promise(function(t){return s=t})).then(function(t){return r=t})},void 0,function(){return i._yield(r).then(function(){})});if(o&&o.then)return o.then(function(){})})),i._emitter.emit("drawStart",{originalEvent:d,canvas:i._canvas,relativePosition:a})},d=function(t,e){if(o){var n={originalEvent:e,canvas:i._canvas,relativePosition:t};s(n),i._emitter.emit("drawing",n)}},p=function(t,e){o&&(document.body.removeChild(i._tmpCanvas),s(),i._ctx.drawImage(i._tmpCanvas,0,0),i._push(o),s=w,o=null,i._emitter.emit("drawEnd",{originalEvent:e,canvas:i._canvas,relativePosition:t}))},m=null,g=[_(r,"mousedown",function(t){var e=y(r,t);a(e,t),d(e,t)}),_(r,"touchstart",function(t){var e=y(r,m=t.touches[0]);a(e,t),d(e,t)}),_(document,"mousemove",function(t){d(y(r,t),t)}),_(document,"touchmove",function(t){d(y(r,m=t.touches[0]),t)}),_(document,"mouseup",function(t){p(y(r,t),t)}),_(document,"touchend",function(t){p(y(r,m),t)})];this.disableMouseDrawing=function(){return g.forEach(function(t){return t()})}},d.prototype.redraw=function(){this.clear();for(var t=0,e=this._figures.slice(0,this._cursor);t<e.length;t+=1)e[t].render(this._ctx)},d.prototype._push=function(t){(this._figures=this._figures.slice(0,this._cursor++)).push(t)},Object.defineProperties(d.prototype,p);export default d;export{d as Painter,v as Ellipse,u as FreeLine,l as Rectangle,c as StraightLine,f as Arrow};
//# sourceMappingURL=index.m.js.map
